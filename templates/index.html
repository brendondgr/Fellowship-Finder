<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Front Page Prototype</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='index.css') }}">
</head>
<body class="bg-gray-100">

    <!-- Header Section -->
    <header class="bg-white shadow-sm">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <h1 class="text-2xl font-bold text-gray-800">ProFellow Data</h1>
                </div>
                <nav class="hidden md:flex md:space-x-8 justify-center">
                    
                </nav>
                <div class="hidden md:flex items-center">
                    <button id="scrape-btn" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 mr-4">
                        <svg class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M17 17H17.01M17.4 14H18C18.9319 14 19.3978 14 19.7654 14.1522C20.2554 14.3552 20.6448 14.7446 20.8478 15.2346C21 15.6022 21 16.0681 21 17C21 17.9319 21 18.3978 20.8478 18.7654C20.6448 19.2554 20.2554 19.6448 19.7654 19.8478C19.3978 20 18.9319 20 18 20H6C5.06812 20 4.60218 20 4.23463 19.8478C3.74458 19.6448 3.35523 19.2554 3.15224 18.7654C3 18.3978 3 17.9319 3 17C3 16.0681 3 15.6022 3.15224 15.2346C3.35523 14.7446 3.74458 14.3552 4.23463 14.1522C4.60218 14 5.06812 14 6 14H6.6M12 15V4M12 15L9 12M12 15L15 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Scrape
                    </button>
                    <a href="https://github.com/brendondgr/Profellow" target="_blank" rel="noopener noreferrer" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-gray-700 bg-gray-100 hover:bg-gray-200">
                        <svg class="h-5 w-5 mr-2" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.477 2 12c0 4.418 2.865 8.165 6.839 9.489.5.092.682-.217.682-.482 0-.237-.009-.868-.014-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.031-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.378.203 2.398.1 2.651.64.7 1.03 1.595 1.03 2.688 0 3.848-2.338 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.001 10.001 0 0022 12c0-5.523-4.477-10-10-10z" clip-rule="evenodd"></path>
                        </svg>
                        Code
                    </a>
                </div>
            </div>
        </div>
    </header>

    <main>
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="container mx-auto px-4 sm:px-6 lg:px-8 pt-4">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }} mb-4 p-4 rounded-md 
                            {% if category == 'error' %}bg-red-100 border border-red-400 text-red-700
                            {% elif category == 'warning' %}bg-yellow-100 border border-yellow-400 text-yellow-700
                            {% else %}bg-green-100 border border-green-400 text-green-700{% endif %}">
                            <span class="font-medium">{{ message }}</span>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        <div class="container mx-auto py-8 px-4 sm:px-6 lg:px-8">
            <div class="max-w-3xl mx-auto">
                <!-- Title -->
                <h2 class="text-4xl font-extrabold tracking-tight text-gray-900 sm:text-5xl md:text-6xl text-center mb-2">
                    <span class="block">Find Your Next <span class="text-indigo-600">Opportunity</span></span>
                </h2>
                <p class="text-center text-lg font-bold text-gray-600 mb-6">Filters:</p>

                <!-- Filters Form -->
                <form method="GET" action="/" class="space-y-6">
                    <!-- Hidden field to preserve per_page setting -->
                    <input type="hidden" name="per_page" value="{{ per_page }}">
                    
                    <!-- Filters Section -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div class="grid grid-cols-1 gap-6">
                            <!-- Min. Stars Slider -->
                            <div>
                                <label for="min_stars" class="block text-lg font-medium text-gray-700">Min. Stars: <span id="min-stars-value" class="font-bold">{{ filters.min_stars }}</span></label>
                                <input type="range" id="min_stars" name="min_stars" min="1" max="5" value="{{ filters.min_stars }}" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                            </div>
                            <!-- Checkboxes -->
                            <div class="grid grid-cols-2 gap-6">
                                <div class="flex items-center">
                                    <input id="favorites_first" name="favorites_first" type="checkbox" value="true" {% if filters.favorites_first %}checked{% endif %} class="h-5 w-5 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                    <label for="favorites_first" class="ml-3 block text-lg text-gray-900">Favorites First</label>
                                </div>
                                <div class="flex items-center">
                                    <input id="show_removed" name="show_removed" type="checkbox" value="true" {% if filters.show_removed %}checked{% endif %} class="h-5 w-5 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                    <label for="show_removed" class="ml-3 block text-lg text-gray-900">Show Removed</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Search Section -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div class="flex items-center">
                            <input type="text" id="keywords" name="keywords" value="{{ filters.keywords }}" placeholder="Enter keywords separated by commas..." class="flex-grow p-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 text-lg">
                            <div class="relative ml-2 group">
                                <svg class="h-6 w-6 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                                </svg>
                                <div class="absolute bottom-full mb-2 w-64 p-2 bg-gray-800 text-white text-sm rounded-md opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none z-10">
                                    Enter keywords to search in Title, Description, and Tags. Separate multiple keywords with a comma. The search is case-insensitive. Results will be ordered by the number of keyword matches.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Get Results Button -->
                    <div class="text-center">
                        <button type="submit" class="w-full px-8 py-3 border border-transparent text-lg font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700">
                            Get Results
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Data Availability Notification -->
            <div id="notification-area" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-6" role="alert">
                <strong class="font-bold">No Processed Data Found!</strong>
                <span class="block sm:inline">Please press the "Process" button at the top of the screen to process the data.</span>
            </div>

            <!-- Controls Row: Total and Items per page -->
            <div id="controls-row" class="flex items-center justify-between mb-6">
                <p class="text-gray-600">Total: <span id="total-opportunities" class="font-semibold">{{ total_count }}</span></p>
                <div class="flex items-center">
                    <form method="GET" action="/" class="flex items-center">
                        <!-- Preserve current filters -->
                        <input type="hidden" name="min_stars" value="{{ filters.min_stars }}">
                        <input type="hidden" name="favorites_first" value="{{ filters.favorites_first|lower }}">
                        <input type="hidden" name="show_removed" value="{{ filters.show_removed|lower }}">
                        <input type="hidden" name="keywords" value="{{ filters.keywords }}">
                        
                        <label for="per_page" class="text-gray-600 mr-2">Show:</label>
                        <select id="per_page" name="per_page" onchange="this.form.submit()" class="border border-gray-300 rounded-md shadow-sm p-2 text-sm focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
                            <option value="20" {% if per_page == 20 %}selected{% endif %}>20</option>
                            <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
                            <option value="100" {% if per_page == 100 %}selected{% endif %}>100</option>
                        </select>
                    </form>
                    <form method="POST" action="/refresh" style="display: inline;">
                        <button type="submit" class="ml-4 p-2 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            <img src="{{ url_for('static', filename='svg/refresh.svg') }}" alt="Refresh" class="h-5 w-5 text-gray-600">
                        </button>
                    </form>
                </div>
            </div>

            <!-- Fellowship Cards Container -->
            <div id="fellowship-cards-container" class="space-y-6">
                {% if data_available and fellowships %}
                    {% for fellowship in fellowships %}
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200 hover:shadow-xl transition-shadow duration-300" data-id="{{ fellowship.id }}">
                        <div class="p-6 md:p-8">
                            <!-- First Row -->
                            <div class="flex flex-wrap items-center justify-between gap-4 mb-4">
                                <div class="flex-1 min-w-0">
                                    <h3 class="text-2xl font-bold text-gray-900 truncate">{{ fellowship.title or 'No Title Provided' }}</h3>
                                    <div class="mt-1 flex flex-wrap items-center text-sm text-gray-500 gap-x-4 gap-y-1">
                                        <span>{{ fellowship.location or 'N/A' }}</span>
                                        <span class="hidden sm:inline">•</span>
                                        <span>{{ fellowship.continent or 'N/A' }}</span>
                                    </div>
                                </div>
                                <div class="flex items-center gap-4 flex-shrink-0">
                                    <div class="text-right">
                                        <p class="text-sm text-gray-500">Apply by</p>
                                        <p class="font-semibold text-gray-700">{{ fellowship.deadline or 'N/A' }}</p>
                                    </div>
                                    <a href="{{ fellowship.link or '#' }}" target="_blank" rel="noopener noreferrer" class="p-2 rounded-full bg-gray-100 hover:bg-indigo-100 text-gray-500 hover:text-indigo-600 transition-colors">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                        </svg>
                                    </a>
                                    <form method="POST" action="/fellowship/{{ fellowship.id }}/favorite" style="display: inline;">
                                        <button type="submit" class="favorite-btn p-2 rounded-full bg-gray-100 hover:bg-red-100 text-gray-500 hover:text-red-600 transition-colors {% if fellowship.favorited %}favorited{% endif %}">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                            </svg>
                                        </button>
                                    </form>
                                    <form method="POST" action="/fellowship/{{ fellowship.id }}/remove" style="display: inline;">
                                        <button type="submit" class="remove-btn p-2 rounded-full bg-gray-100 hover:bg-red-100 text-gray-500 hover:text-red-600 transition-colors" onclick="return confirm('Are you sure you want to remove this fellowship?')">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                            </svg>
                                        </button>
                                    </form>
                                </div>
                            </div>
                            <!-- Second Row: Description -->
                            <div class="mt-6 border-t border-gray-200 pt-6">
                                <h4 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2">Description</h4>
                                <p class="text-gray-600 leading-relaxed">{{ fellowship.description or 'No description available.' }}</p>
                            </div>
                            <!-- Third Row: Details -->
                            <div class="mt-6 border-t border-gray-200 pt-6 grid grid-cols-1 md:grid-cols-3 gap-y-6 gap-x-8">
                                <div class="md:col-span-2">
                                    <h4 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3">Key Features</h4>
                                    <div class="flex flex-wrap gap-2">
                                        {% if fellowship.subjects %}
                                            {% for subject in fellowship.subjects %}
                                            <span class="px-3 py-1 text-xs font-medium bg-indigo-100 text-indigo-800 rounded-full">{{ subject }}</span>
                                            {% endfor %}
                                        {% else %}
                                            <span class="text-gray-500">N/A</span>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="md:col-span-1 grid grid-cols-3 gap-4 text-center md:text-left">
                                    <div>
                                        <h4 class="text-sm font-semibold text-gray-500 uppercase tracking-wider truncate">Total</h4>
                                        <p class="text-lg font-semibold text-gray-800">{{ fellowship.total_compensation or 'N/A' }}</p>
                                    </div>
                                    <div>
                                        <h4 class="text-sm font-semibold text-gray-500 uppercase tracking-wider">Length</h4>
                                        <p class="text-lg font-semibold text-gray-800">{{ fellowship.length_in_years or 'N/A' }} years</p>
                                    </div>
                                    <div>
                                        <h4 class="text-sm font-semibold text-gray-500 uppercase tracking-wider">Rating</h4>
                                        <div class="flex items-center justify-center md:justify-start">
                                            {% set rating = fellowship.interest_rating or 0 %}
                                            {% for i in range(1, 6) %}
                                                {% if i <= rating %}
                                                <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" clip-rule="evenodd" />
                                                </svg>
                                                {% else %}
                                                <svg class="w-5 h-5 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" clip-rule="evenodd" />
                                                </svg>
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% elif not data_available %}
                    <div class="bg-red-100 border border-red-400 text-red-700 px-6 py-8 rounded-lg text-center" role="alert">
                        <svg class="mx-auto h-12 w-12 text-red-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z" />
                        </svg>
                        <h3 class="text-lg font-bold mb-2">No Processed Data Found!</h3>
                        <p class="mb-4">It looks like there's no fellowship data available yet.</p>
                        <p class="text-sm">Please press the "Scrape" button at the top of the screen to scrape and process fellowship data from ProFellow.com.</p>
                    </div>
                {% else %}
                    <div class="bg-yellow-100 border border-yellow-400 text-yellow-700 px-6 py-8 rounded-lg text-center" role="alert">
                        <svg class="mx-auto h-12 w-12 text-yellow-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                        <h3 class="text-lg font-bold mb-2">No Results Found!</h3>
                        <p class="mb-4">No fellowships match your current search criteria.</p>
                        <p class="text-sm">Try adjusting your filters, changing your search keywords, or clearing all filters to see more results.</p>
                        <div class="mt-4">
                            <a href="/" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-yellow-700 bg-yellow-200 hover:bg-yellow-300">
                                Clear All Filters
                            </a>
                        </div>
                    </div>
                {% endif %}
            </div>

            <!-- Pagination Controls -->
            {% if data_available and total_count > 0 %}
            <div id="pagination-container" class="mt-8">
                <!-- Page Info -->
                <div class="text-center mb-4">
                    <p class="text-gray-600">
                        Showing {{ ((current_page - 1) * per_page + 1) }} to {{ [current_page * per_page, total_count] | min }} of {{ total_count }} fellowships
                        {% if current_page > 1 %} (Page {{ current_page }} of {{ total_pages }}){% endif %}
                    </p>
                </div>
                
                <!-- Pagination Buttons -->
                {% if total_pages > 1 %}
                <div class="flex justify-center items-center space-x-2">
                    <!-- Previous Button -->
                    {% if has_previous %}
                        <a href="?page={{ previous_page }}&per_page={{ per_page }}&min_stars={{ filters.min_stars }}&favorites_first={{ filters.favorites_first|lower }}&show_removed={{ filters.show_removed|lower }}&keywords={{ filters.keywords }}" 
                           class="px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                            Previous
                        </a>
                    {% else %}
                        <span class="px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-400 bg-gray-100 cursor-not-allowed">
                            Previous
                        </span>
                    {% endif %}
                    
                    <!-- Page Numbers -->
                    {% for page_num in page_range %}
                        {% if page_num == current_page %}
                            <span class="px-4 py-2 border border-indigo-500 text-sm font-medium rounded-md text-white bg-indigo-600">
                                {{ page_num }}
                            </span>
                        {% else %}
                            <a href="?page={{ page_num }}&per_page={{ per_page }}&min_stars={{ filters.min_stars }}&favorites_first={{ filters.favorites_first|lower }}&show_removed={{ filters.show_removed|lower }}&keywords={{ filters.keywords }}" 
                               class="px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                                {{ page_num }}
                            </a>
                        {% endif %}
                    {% endfor %}
                    
                    <!-- Next Button -->
                    {% if has_more %}
                        <a href="?page={{ next_page }}&per_page={{ per_page }}&min_stars={{ filters.min_stars }}&favorites_first={{ filters.favorites_first|lower }}&show_removed={{ filters.show_removed|lower }}&keywords={{ filters.keywords }}" 
                           class="px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                            Next
                        </a>
                    {% else %}
                        <span class="px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-400 bg-gray-100 cursor-not-allowed">
                            Next
                        </span>
                    {% endif %}
                </div>
                
                <!-- Load More Style Button (Alternative) -->
                {% else %}
                <!-- Single page - just show Load More style for consistency -->
                <div class="text-center">
                    <p class="text-gray-500">No more available</p>
                </div>
                {% endif %}
            </div>
            {% endif %}

            <!-- Undo Container -->
            <div id="undo-container" class="fixed bottom-4 right-4 bg-gray-800 text-white p-4 rounded-lg shadow-lg flex items-center gap-4 hidden">
                <span>Fellowship removed.</span>
                <button id="undo-btn" class="font-semibold text-indigo-400 hover:text-indigo-300">Undo</button>
            </div>

                <!-- Generic Notification Container -->
                <div id="notification-container" class="fixed top-20 right-4 bg-blue-500 text-white p-4 rounded-lg shadow-lg hidden z-50">
                    <span id="notification-message"></span>
                </div>

            </div>
        </div>
    </main>

    <!-- Scrape Modal -->
    <div id="scrape-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div id="scrape-modal-content" class="p-8">
            <!-- Content from scrape.html will be loaded here -->
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Update min stars value display
            const minStarsSlider = document.getElementById('min_stars');
            const minStarsValue = document.getElementById('min-stars-value');
            
            if (minStarsSlider && minStarsValue) {
                minStarsSlider.addEventListener('input', () => {
                    minStarsValue.textContent = minStarsSlider.value;
                });
            }
            
            // Auto-hide flash messages after 5 seconds
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                setTimeout(() => {
                    alert.style.opacity = '0';
                    setTimeout(() => {
                        alert.remove();
                    }, 300);
                }, 5000);
            });
            
            // Add loading state to forms
            const forms = document.querySelectorAll('form');
            forms.forEach(form => {
                form.addEventListener('submit', (e) => {
                    const submitBtn = form.querySelector('button[type="submit"]');
                    if (submitBtn) {
                        submitBtn.disabled = true;
                        submitBtn.innerHTML = submitBtn.innerHTML + ' <span class="loading">...</span>';
                    }
                });
            });
            
            // Handle scrape modal (keep existing functionality)
            const scrapeBtn = document.getElementById('scrape-btn');
            const scrapeModal = document.getElementById('scrape-modal');
            const scrapeModalContent = document.getElementById('scrape-modal-content');
            
            if (scrapeBtn && scrapeModal) {
                scrapeBtn.addEventListener('click', () => {
                    // Load content from scrape.html
                    fetch('/scrape')
                        .then(response => response.text())
                        .then(html => {
                            scrapeModalContent.innerHTML = html;
                            scrapeModal.classList.remove('hidden');
                            scrapeModal.classList.add('flex');
                        })
                        .catch(error => {
                            console.error('Error loading scrape page:', error);
                            scrapeModalContent.innerHTML = '<p class="p-8 text-red-500">Could not load scrape options. Please try again later.</p>';
                            scrapeModal.classList.remove('hidden');
                            scrapeModal.classList.add('flex');
                        });
                });
                
                // Close modal on background click
                scrapeModal.addEventListener('click', (e) => {
                    if (e.target === scrapeModal) {
                        scrapeModal.classList.add('hidden');
                        scrapeModal.classList.remove('flex');
                        scrapeModalContent.innerHTML = '';
                    }
                });
            }
        });
    </script>
</body>
</html>
